<% if @is_owning_user || @old_unclassified %>

    <%= form_for(@info_request, :as => :incoming_message, :url => describe_state_url(:id => @info_request.id), :html => {:id => "describe_form_#{id_suffix}"}) do |f| %>
        <h2><%= @is_owning_user ? _('What best describes the status of this request now?') : _('Hi! We need your help. The person who made the following request hasn\'t told us whether or not it was successful. Would you mind taking a moment to read it and help us keep the place tidy for everyone? Thanks.') %></h2>

        <ul class="update_status_options">
            <li class="successful">
                <div>
                    <%= radio_button "incoming_message", "described_state", "partially_successful", :id => 'partially_successful' + id_suffix %>
                    <label for="partially_successful<%=id_suffix%>"><%= @is_owning_user ? _('I\'ve received <strong>some of the information</strong>') : _('<strong>Some of the information</strong> has been sent ') %> </label>
                </div>

                <div>
                    <%= radio_button "incoming_message", "described_state", "successful", :id => 'successful' + id_suffix %>
                    <label for="successful<%=id_suffix%>"><%= @is_owning_user ?  _('I\'ve received <strong>all the information') : _('<strong>All the information</strong> has been sent') %></strong> </label>
                </div>
                <%= render :partial => 'general/custom_state_transitions_successful', :locals => {:id_suffix => id_suffix } %>
            </li>

            <li class="pending">
                <% if @info_request.described_state != 'internal_review' %>
                    <div>
                        <%= radio_button "incoming_message", "described_state", "waiting_response", :id => 'waiting_response' + id_suffix %>
                        <label for="waiting_response<%=id_suffix%>"><%= @is_owning_user ? _('I\'m still <strong>waiting</strong> for my information <small>(maybe you got an acknowledgement)</small>') : _('<strong>No response</strong> has been received <small>(maybe there\'s just an acknowledgement)</small>') %></label>
                    </div>
                    <div>
                        <%= radio_button "incoming_message", "described_state", "waiting_clarification", :id => 'waiting_clarification' + id_suffix %>
                        <label for="waiting_clarification<%=id_suffix%>"><%= @is_owning_user ? _('I\'ve been asked to <strong>clarify</strong> my request') : _('<strong>Clarification</strong> has been requested') %></label>
                    </div>
                <% else %>
                    <div>
                        <%= radio_button "incoming_message", "described_state", "internal_review", :id => 'internal_review' + id_suffix %>
                        <label for="internal_review<%=id_suffix%>"><%= @is_owning_user ? _('I\'m still <strong>waiting</strong> for the internal review') : _('Still awaiting an <strong>internal review</strong>') %></label>
                    </div>
                <% end %>
                <% if @update_status && @info_request.described_state != 'internal_review' %>
                    <div>
                        <%= radio_button "incoming_message", "described_state", "internal_review", :id => 'internal_review' + id_suffix %>
                        <label for="internal_review<%=id_suffix%>"><%= _('I\'m waiting for an <strong>internal review</strong> response') %></label>
                    </div>
                <% end %>
                <div>
                    <%= radio_button "incoming_message", "described_state", "gone_postal", :id => 'gone_postal' + id_suffix %>
                    <label for="gone_postal<%=id_suffix%>"><%= @is_owning_user ? _('They are going to reply <strong>by post</strong>') : _('A response will be sent <strong>by post</strong>') %></label>
                </div>

                <% if @update_status %>
                  <div>
                     <%= radio_button "incoming_message", "described_state", "requires_admin", :id => 'requires_admin' + id_suffix %>
                      <label for="requires_admin<%=id_suffix%>">
                      <%= _('This request <strong>requires administrator attention</strong>') %>
                      </label>
                  </div>
                <% end %>

                <%= render :partial => 'general/custom_state_transitions_pending', :locals => {:id_suffix => id_suffix } %>
            </li>

            <li class="unsuccessful">
                <div>
                    <%= radio_button "incoming_message", "described_state", "not_held", :id => 'not_held' + id_suffix %>
                    <label for="not_held<%=id_suffix%>"><%= @is_owning_user ? _('They do <strong>not have</strong> the information <small>(maybe they say who does)</small>') : _('The authority do <strong>not have</strong> the information <small>(maybe they say who does)</small>') %></label>
                </div>
                <div>
                    <%= radio_button "incoming_message", "described_state", "rejected", :id => 'rejected' + id_suffix %>
                    <label for="rejected<%=id_suffix%>"><%= @is_owning_user ? _('My request has been <strong>refused</strong>') :  _('The request has been <strong>refused</strong>') %></label>
                </div>

                <div>
                   <%= radio_button "incoming_message", "described_state", "error_message", :id => 'error_message' + id_suffix %>
                    <label for="error_message<%=id_suffix%>">
                    <%= @is_owning_user ? _('I\'ve received an <strong>error message</strong>') : _('An <strong>error message</strong> has been received')  %>
                    </label>
                </div>

                <% if @update_status %>
                  <div>
                     <%= radio_button "incoming_message", "described_state", "user_withdrawn", :id => 'user_withdrawn' + id_suffix %>
                      <label for="user_withdrawn<%=id_suffix%>">
                      <%= _('I would like to <strong>withdraw this request</strong>') %>
                      </label>
                  </div>
                <% end %>
                <%= render :partial => 'general/custom_state_transitions_unsuccessful', :locals => {:id_suffix => id_suffix } %>
            </li>
        </ul>


        <p>
          <%= hidden_field_tag 'last_info_request_event_id', @last_info_request_event_id, :id => 'last_info_request_event_id' + id_suffix %>
          <%= submit_tag _("Submit status") %> <% if @is_owning_user %>(<%= _('and we\'ll suggest <strong>what to do next</strong>') %>)<% end %>
        </p>
    <% end %>
<% else %>
  <% if !@info_request.is_external? %>
    <%=  _('We don\'t know whether the most recent response to this request contains
    information or not
        &ndash;
  if you are {{user_link}} please <a href="{{url}}">sign in</a> and let everyone know.',:user_link=>user_link(@info_request.user), :url=>signin_url(:r => request.fullpath)) %>
  <% end %>
<% end %>
