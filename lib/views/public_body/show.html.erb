<% @title = h(@public_body.name) + _(" - view and make Freedom of Information requests") %>
<header>
    <div>
        <p class="authority-meta subtitle"><%= _("Freedom of information requests to:") %></p>
        <h1 class="authority-title">
            <%= @public_body.name %>
            <a class="rss_link" href="<%= do_track_path(@track_thing, 'feed') %>">RSS Feed</a>
        </h1>
        <p class="subtitle">
          <%= @public_body.type_of_authority(true) %><% if not @public_body.short_name.empty? %>,
            <%= _('also called {{public_body_short_name}}', :public_body_short_name =>  h(@public_body.short_name))%>
          <%- end %>
          <% if !@user.nil? && @user.admin_page_links? %>
            (<%= link_to _("admin"), admin_body_show_path(@public_body) %>)
          <% end %>
        </p>
        <% if !@public_body.is_requestable? %>
          <% if @public_body.not_requestable_reason == 'not_apply' %>
              <p class="authority_notes"><%= _('Freedom of Information law does not apply to this authority, so you cannot make
              a request to it.')%></p>
          <% elsif @public_body.not_requestable_reason == 'defunct' %>
              <p class="authority_notes"><%= _('This authority no longer exists, so you cannot make a request to it.')%></p>
          <% else %>
              <p class="authority_notes"><%= _('For an unknown reason, it is not possible to make a request to this authority.')%></p>
          <% end %>
        <% end %>
        <% if @public_body.has_notes? %>
            <p class="authority_notes">
              <%= @public_body.notes_as_html.html_safe %>
            </p>
        <% end %>
        <% if @public_body.eir_only? %>
            <p class="authority_notes"><%= _('You can only request information about the environment from this authority.') %></p>
        <% end %>

    </div>

    <ul class="authority-interactions">
        <% if @public_body.is_requestable? || @public_body.not_requestable_reason == 'bad_contact' %>
            <li>
              <%= link_to _("Make a request to this authority <small>Itâ€™s your right!</small>"), new_request_to_body_path(:url_name => @public_body.url_name), :class => "authority-interactions-getupdates" %>
            </li>
            <% if @public_body.override_request_email %>
                <p>
                    <%= _("<strong>Note:</strong> Because we're testing, requests are being sent to {{email}} rather than to the actual authority.", :email => @public_body.override_request_email) %>
                </p>
            <% end %>
        <% end %>
        <li>
          <%= track_link(@user, @track_thing, _("Get alerts on this authority <small>For all new requests</small>"), _("Unsubscribe"), request) %>
        </li>
    </ul>
</header>
<div id="list-filter">
  <% if  @public_body.info_requests.size > 4 %>
    <h2><%= _('Filter Requests') %></h2>
    <%= render :partial => 'request/request_filter_form' %>
    <% existing_track = TrackThing.find_by_existing_track(@user, @query_track_thing) %>
    <% if existing_track %>
      <%= link_to(_("Unsubscribe from keyword alerts for this search"), track_unsubscribe_path(existing_track, request)) %>
    <% else %>
      <%= link_to _("Get keyword alerts for this search"), params.merge(:track_keywords => 1)%>
    <% end %>
  <% end %>
  <% if !@public_body.calculated_home_page.nil? %>
      <%= link_to _('Website of authority'), @public_body.calculated_home_page, :class => 'authority_homepage' %>
  <% end %>
  <% if !@public_body.publication_scheme.empty? %>
      <%= link_to _('Publication scheme'), @public_body.publication_scheme, :class => 'authority_publication_scheme' %>
  <% end %>
  <% unless @public_body.disclosure_log.empty? %>
      <%= link_to _('Disclosure log'), @public_body.disclosure_log, :class => 'authority_disclosure_log' %>
  <% end %>
  <% if @public_body.has_tag?("charity") %>
      <% for tag_value in @public_body.get_tag_values("charity") %>
          <% if tag_value.match(/^SC/) %>
              <%= link_to _('Charity registration'), "http://www.oscr.org.uk/CharityIndexDetails.aspx?id=" + tag_value, :class => 'authority_charity_registration' %>
          <% else %>
              <%= link_to _('Charity registration'), "http://www.charity-commission.gov.uk/SHOWCHARITY/RegisterOfCharities/CharityFramework.aspx?RegisteredCharityNumber=" + tag_value, :class => 'authority_charity_registration' %>
          <% end %>
      <% end %>
  <% end %>
  <%= link_to _('View authority email address'), view_public_body_email_path(@public_body.url_name), :class => 'authority_email' %>
</div>

<div id="foi_results_section">

  <h2 class="foi_results">
    <% if !@xapian_requests.nil? %>
      <%= n_('We have {{count}} request sent from our community',
             'We have {{count}} requests sent from our community',
             @xapian_requests.matches_estimated,
             :count => @xapian_requests.matches_estimated) %>
    <% else %>
      <%= _("Requests sent from our community") %>
    <% end %>
    <%= @page_desc %>
  </h2>

  <div class="results_section">
      <% if @xapian_requests.nil? %>
        <p> <%= _('The search index is currently offline, so we can\'t show the requests that have been made to this authority.') %></p>
      <% elsif @xapian_requests.results.empty? %>
        <p><% _('There were no requests matching your query.') %></p>
      <% else %>
        <ol class="results_block">
          <% for result in @xapian_requests.results %>
              <%= render :partial => 'request/request_listing_via_event', :locals => { :event => result[:model], :info_request => result[:model].info_request } %>
          <% end %>
        </ol>
        <%= will_paginate WillPaginate::Collection.new(@page, @per_page, @xapian_requests.matches_estimated) %>
      <% end %>
  </div>
    <% if !@xapian_requests.results.empty? %>
      <p> <%= _('Only requests made using {{site_name}} are shown.', :site_name => site_name) %></p>
    <% end %>
</div>
